diff -ru a/configure.ac b/configure.ac
--- a/configure.ac	2011-08-17 23:48:24 -0500
+++ b/configure.ac	2012-04-15 23:13:25 -0500
@@ -482,6 +482,9 @@
 	AC_DEFINE([SSH_IOBUFSZ], [65535], [Windows is sensitive to read buffer size])
 	AC_DEFINE([FILESYSTEM_NO_BACKSLASH], [1], [File names may not contain backslash characters]) 
 	;;
+*-*-msys*)
+	AC_DEFINE([HAVE_CYGWIN], [1], [Define if you are on Cygwin])
+	;;
 *-*-dgux*)
 	AC_DEFINE([IP_TOS_IS_BROKEN], [1],
 		[Define if your system choked on IP TOS setting])
diff -ru a/defines.h b/defines.h
--- a/defines.h	2011-06-02 20:17:49 -0500
+++ b/defines.h	2012-04-15 23:21:48 -0500
@@ -778,6 +778,12 @@
 # undef HAVE_MMAP
 #endif
 
+#ifdef __MSYS__
+#undef IOV_MAX
+#define IOV_MAX 1024
+#define SETGROUPS_NOOP
+#endif
+
 #ifndef IOV_MAX
 # if defined(_XOPEN_IOV_MAX)
 #  define	IOV_MAX		_XOPEN_IOV_MAX
diff -ru a/openbsd-compat/bsd-misc.c b/openbsd-compat/bsd-misc.c
--- a/openbsd-compat/bsd-misc.c	2010-11-08 16:26:23 -0600
+++ b/openbsd-compat/bsd-misc.c	2012-04-15 23:22:59 -0500
@@ -134,6 +134,17 @@
 }
 #endif /* HAVE_TRUNCATE */
 
+#if !defined(HAVE_SETGROUPS) && defined(SETGROUPS_NOOP)
+/*
+ * MSYS setgroups should be a noop.
+ */
+int
+setgroups(size_t size, const gid_t *list)
+{
+	return (0);
+}
+#endif
+
 #if !defined(HAVE_NANOSLEEP) && !defined(HAVE_NSLEEP)
 int nanosleep(const struct timespec *req, struct timespec *rem)
 {
diff -ru a/openbsd-compat/bsd-openpty.c b/openbsd-compat/bsd-openpty.c
--- a/openbsd-compat/bsd-openpty.c	2006-08-24 04:52:30 -0500
+++ b/openbsd-compat/bsd-openpty.c	2012-04-15 23:04:00 -0500
@@ -121,6 +121,8 @@
 		return (-1);
 	}
 
+/* the following hunk is ok on real cygwin, but dies on msys */
+#ifndef HAVE_CYGWIN
 	/*
 	 * Try to push the appropriate streams modules, as described 
 	 * in Solaris pts(7).
@@ -130,6 +132,7 @@
 # ifndef __hpux
 	ioctl(*aslave, I_PUSH, "ttcompat");
 # endif /* __hpux */
+#endif /* HAVE_CYGWIN */
 
 	return (0);
 
